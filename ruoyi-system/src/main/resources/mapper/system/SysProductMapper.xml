<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.SysProductMapper">
    
    <resultMap type="SysProduct" id="SysProductResult">
        <result property="productId"    column="product_id"    />
        <result property="supplierId"    column="supplier_id"    />
        <result property="supplierName"    column="supplier_name"    />
        <result property="primaryCategory"    column="primary_category"    />
        <result property="primaryCategoryName"    column="primary_category_name"    />
        <result property="secondaryCategory"    column="secondary_category"    />
        <result property="secondaryCategoryName"    column="secondary_category_name"    />
        <result property="tertiaryCategory"    column="tertiary_category"    />
        <result property="tertiaryCategoryName"    column="tertiary_category_name"    />
        <result property="quaternaryCategory"    column="quaternary_category"    />
        <result property="quaternaryCategoryName"    column="quaternary_category_name"    />
        <result property="fifthCategory"    column="fifth_category"    />
        <result property="fifthCategoryName"    column="fifth_category_name"    />
        <result property="cnPrimaryCategory"    column="cn_primary_category"    />
        <result property="cnPrimaryCategoryName"    column="cn_primary_category_name"    />
        <result property="cnSecondaryCategory"    column="cn_secondary_category"    />
        <result property="cnSecondaryCategoryName"    column="cn_secondary_category_name"    />
        <result property="cnTertiaryCategory"    column="cn_tertiary_category"    />
        <result property="cnTertiaryCategoryName"    column="cn_tertiary_category_name"    />
        <result property="cnQuaternaryCategory"    column="cn_quaternary_category"    />
        <result property="cnQuaternaryCategoryName"    column="cn_quaternary_category_name"    />
        <result property="cnFifthCategory"    column="cn_fifth_category"    />
        <result property="cnFifthCategoryName"    column="cn_fifth_category_name"    />
        <result property="productName"    column="product_name"    />
        <result property="domesticImportedType"    column="domestic_imported_type"    />
        <result property="productModel"    column="product_model"    />
        <result property="quotationFlag"    column="quotation_flag"    />
        <result property="tagId"    column="tag_id"    />
        <result property="tagName"    column="tag_name"    />
        <result property="productImage"    column="product_image"    />
        <result property="productVideo"    column="product_video"    />
        <result property="futureField1"    column="future_field1"    />
        <result property="futureField2"    column="future_field2"    />
        <result property="futureField3"    column="future_field3"    />
    </resultMap>

    <sql id="selectSysProductVo">
        select product_id AS productId,supplier_id AS supplierId,supplier_name AS supplierName,primary_category AS primaryCategory,
               primary_category_name AS primaryCategoryName,secondary_category AS secondaryCategory,secondary_category_name AS secondaryCategoryName,
               tertiary_category AS tertiaryCategory,tertiary_category_name AS tertiaryCategoryName,quaternary_category AS quaternaryCategory,
               quaternary_category_name AS quaternaryCategoryName,fifth_category AS fifthCategory,fifth_category_name AS fifthCategoryName,
               cn_primary_category AS cnPrimaryCategory,cn_primary_category_name AS cnPrimaryCategoryName,cn_secondary_category AS cnSecondaryCategory,
               cn_secondary_category_name AS cnSecondaryCategoryName,cn_tertiary_category AS cnTertiaryCategory,cn_tertiary_category_name AS cnTertiaryCategoryName,
               cn_quaternary_category AS cnQuaternaryCategory,cn_quaternary_category_name AS cnQuaternaryCategoryName,
               cn_fifth_category AS cnFifthCategory,cn_fifth_category_name AS cnFifthCategoryName,
               tag_id AS tagId,tag_name AS tagName,product_image AS productImage,product_video AS productVideo,
               product_name AS productName,domestic_imported_type AS domesticImportedType,
               product_model AS productModel,quotation_flag AS quotationFlag,sample AS sample,
               specifications AS specifications,inventory AS inventory,
               status AS status,production_date AS productionDate,shelf_life AS shelfLife,origin AS origin,
               storage_mode AS storageMode,warehouse_address AS warehouseAddress,main_product AS mainProduct,
               del_flag AS delFlag,quote_status AS quoteStatus,inquiry_status AS inquiryStatus,buyer_id AS buyerId,
               inquiry_list_flag AS inquiryListFlag,quote_list_flag AS quoteListFlag,remark AS remark,
               mark AS mark,unitprice AS unitprice,unitprice_unit AS unitpriceUnit,
               start_batch AS startBatch,batch_unit AS batchUnit
               from sys_product
    </sql>

<!--    这里是根据三个不同的角色查找产品，只查产品，不查其他内容，不涉及到产品报价询价等，后面看看能不能改造一下吧-->
    <select id="selectSysProductList" parameterType="SysProDuctDTO"
            resultType="com.ruoyi.system.domain.vo.SysProductVO">
        <choose>
            <when test="flag">
                <!-- 当flag为true时，使用selectSysProductVo,不需要查供应商名字，因为是供应商自己在查询 -->
                <include refid="selectSysProductVo"/>
            </when>
            <otherwise>
                <!-- 当flag为false时，使用连表，但需要注意连接条件和字段选择，这是采购员或者管理员的查询，需要供应商名字 -->
                SELECT a.product_id AS productId,a.supplier_id AS supplierId,a.supplier_name AS supplierName,a.primary_category AS primaryCategory,
                a.primary_category_name AS primaryCategoryName,a.secondary_category AS secondaryCategory,a.secondary_category_name AS secondaryCategoryName,
                a.tertiary_category AS tertiaryCategory,a.tertiary_category_name AS tertiaryCategoryName,a.quaternary_category AS quaternaryCategory,
                a.quaternary_category_name AS quaternaryCategoryName,a.fifth_category AS fifthCategory,a.fifth_category_name AS fifthCategoryName,
                a.cn_primary_category AS cnPrimaryCategory,a.cn_primary_category_name AS cnPrimaryCategoryName,a.cn_secondary_category AS cnSecondaryCategory,
                a.cn_secondary_category_name AS cnSecondaryCategoryName,a.cn_tertiary_category AS cnTertiaryCategory,a.cn_tertiary_category_name AS cnTertiaryCategoryName,
                a.cn_quaternary_category AS cnQuaternaryCategory,a.cn_quaternary_category_name AS cnQuaternaryCategoryName,
                a.cn_fifth_category AS cnFifthCategory,a.cn_fifth_category_name AS cnFifthCategoryName,
                a.tag_id AS tagId,a.tag_name AS tagName,a.product_image AS productImage,a.product_video AS productVideo,
                a.product_name AS productName,a.domestic_imported_type AS domesticImportedType,
                a.product_model AS productModel,a.quotation_flag AS quotationFlag,a.sample AS sample,
                a.specifications AS specifications,a.inventory AS inventory,
                a.status AS status,a.production_date AS productionDate,a.shelf_life AS shelfLife,a.origin AS origin,
                a.storage_mode AS storageMode,a.warehouse_address AS warehouseAddress,a.main_product AS mainProduct,
                a.del_flag AS delFlag,a.quote_status AS quoteStatus,a.inquiry_status AS inquiryStatus,a.buyer_id AS buyerId,
                a.inquiry_list_flag AS inquiryListFlag,a.quote_list_flag AS quoteListFlag,a.remark AS remark,
                a.mark AS mark,a.unitprice AS unitprice,a.unitprice_unit AS unitpriceUnit,
                a.start_batch AS startBatch,a.batch_unit AS batchUnit,
                b.supplier_name_cn as supplierNameCn,b.supplier_name_en as supplierNameEn,b.supplier_name_own as supplierNameOwn
                FROM sys_product a
                LEFT JOIN sys_supplier b ON a.supplier_id = b.supplier_id
            </otherwise>
        </choose>
        <where>
            <if test="flag == false">
                    <!--如果他为false，说明是采购员或者管理员，需要供应商名字查询 -->
                <if test="supplierName != null  and supplierName != ''"> and b.supplier_name_cn like concat('%', #{supplierName}, '%')</if>
                <if test="supplierName != null  and supplierName != ''"> and b.supplier_name_en like concat('%', #{supplierName}, '%')</if>
                <if test="supplierName != null  and supplierName != ''"> and b.supplier_name_own like concat('%', #{supplierName}, '%')</if>
            </if>

            <if test="supplierId != null  and supplierId != ''"> and supplier_id = #{supplierId}</if>
            <if test="buyerId!=null"> and buyer_id = #{buyerId}</if>
            <if test="startInventory != null">inventory &gt;= #{startInventory}</if>
            <if test="endInventory != null">inventory &lt;= #{endInventory}</if>

            <if test="origins != null and !origins.isEmpty()">
                AND origin IN
                <foreach collection="origins" item="origin" open="(" close=")" separator=",">
                    #{origin}
                </foreach>
            </if>

            <if test="cnPrimaryCategorys != null and !cnPrimaryCategorys.isEmpty()">
                AND cn_primary_category IN
                <foreach collection="cnPrimaryCategorys" item="cnPrimary" open="(" close=")" separator=",">
                    #{cnPrimary}
                </foreach>
            </if>
            <if test="cnSecondaryCategorys != null and !cnSecondaryCategorys.isEmpty()">
                AND cn_secondary_category IN
                <foreach collection="cnSecondaryCategorys" item="cnSecondary" open="(" close=")" separator=",">
                    #{cnSecondary}
                </foreach>
            </if>
            <if test="cnTertiaryCategorys != null and !cnTertiaryCategorys.isEmpty()">
                AND cn_tertiary_category IN
                <foreach collection="cnTertiaryCategorys" item="cnTertiary" open="(" close=")" separator=",">
                    #{cnTertiary}
                </foreach>
            </if>
            <if test="cnQuaternaryCategorys != null and !cnQuaternaryCategorys.isEmpty()">
                AND cn_quaternary_category IN
                <foreach collection="cnQuaternaryCategorys" item="cnQuaternary" open="(" close=")" separator=",">
                    #{cnQuaternary}
                </foreach>
            </if>
            <if test="cnFifthCategorys != null and !cnFifthCategorys.isEmpty()">
                AND cn_fifth_category IN
                <foreach collection="cnFifthCategorys" item="cnFifth" open="(" close=")" separator=",">
                    #{cnFifth}
                </foreach>
            </if>

<!--            <if test="primaryCategory != null  and primaryCategory != ''"> and primary_category = #{primaryCategory}</if>-->
<!--            <if test="primaryCategoryName != null  and primaryCategoryName != ''"> and primary_category_name like concat('%', #{primaryCategoryName}, '%')</if>-->
<!--            <if test="secondaryCategory != null  and secondaryCategory != ''"> and secondary_category = #{secondaryCategory}</if>-->
<!--            <if test="secondaryCategoryName != null  and secondaryCategoryName != ''"> and secondary_category_name like concat('%', #{secondaryCategoryName}, '%')</if>-->
<!--            <if test="tertiaryCategory != null  and tertiaryCategory != ''"> and tertiary_category = #{tertiaryCategory}</if>-->
<!--            <if test="tertiaryCategoryName != null  and tertiaryCategoryName != ''"> and tertiary_category_name like concat('%', #{tertiaryCategoryName}, '%')</if>-->
<!--            <if test="quaternaryCategory != null  and quaternaryCategory != ''"> and quaternary_category = #{quaternaryCategory}</if>-->
<!--            <if test="quaternaryCategoryName != null  and quaternaryCategoryName != ''"> and quaternary_category_name like concat('%', #{quaternaryCategoryName}, '%')</if>-->
<!--            <if test="fifthCategory != null  and fifthCategory != ''"> and fifth_category = #{fifthCategory}</if>-->
<!--            <if test="fifthCategoryName != null  and fifthCategoryName != ''"> and fifth_category_name like concat('%', #{fifthCategoryName}, '%')</if>-->
            <if test="productName != null  and productName != ''"> and product_name like concat('%', #{productName}, '%')</if>
<!--            <if test="cnPrimaryCategory != null  and cnPrimaryCategory != ''"> and cn_primary_category = #{cnPrimaryCategory}</if>-->
<!--            <if test="cnPrimaryCategoryName != null  and cnPrimaryCategoryName != ''"> and cn_primary_category_name like concat('%', #{cnPrimaryCategoryName}, '%')</if>-->
<!--            <if test="cnSecondaryCategory != null  and cnSecondaryCategory != ''"> and cn_secondary_category = #{cnSecondaryCategory}</if>-->
<!--            <if test="cnSecondaryCategoryName != null  and cnSecondaryCategoryName != ''"> and cn_secondary_category_name like concat('%', #{cnSecondaryCategoryName}, '%')</if>-->
<!--            <if test="cnTertiaryCategory != null  and cnTertiaryCategory != ''"> and cn_tertiary_category = #{cnTertiaryCategory}</if>-->
<!--            <if test="cnTertiaryCategoryName != null  and cnTertiaryCategoryName != ''"> and cn_tertiary_category_name like concat('%', #{cnTertiaryCategoryName}, '%')</if>-->
<!--            <if test="cnQuaternaryCategory != null  and cnQuaternaryCategory != ''"> and cn_quaternary_category = #{cnQuaternaryCategory}</if>-->
<!--            <if test="cnQuaternaryCategoryName != null  and cnQuaternaryCategoryName != ''"> and cn_quaternary_category_name like concat('%', #{cnQuaternaryCategoryName}, '%')</if>-->
<!--            <if test="cnFifthCategory != null  and cnFifthCategory != ''"> and cn_fifth_category = #{cnFifthCategory}</if>-->
<!--            <if test="cnFifthCategoryName != null  and cnFifthCategoryName != ''"> and cn_fifth_category_name like concat('%', #{cnFifthCategoryName}, '%')</if>-->
            <if test="domesticImportedType != null "> and domestic_imported_type = #{domesticImportedType}</if>
<!--             <if test="productModel != null  and productModel != ''"> and product_model = #{productModel}</if>-->
            <if test="quotationFlag != null "> and quotation_flag = #{quotationFlag}</if>
            <if test="sample != null">sample=#{sample}</if>
            <if test="status != null"> status=#{status}</if>
            <if test="storageMode !=null">storage_mode=#{storageMode}</if>
            <if test="warehouseAddress!=null and warehouseAddress!=''">warehouse_address like concat('%', #{warehouseAddress}, '%')</if>
            <if test="mainProduct != null">main_product=#{mainProduct}</if>
            <if test="quoteStatus !=null">quote_status=#{quoteStatus}</if>
            <if test="inquiryStatus !=null">inquiry_status=#{inquiryStatus}</if>
            <if test="inquiryListFlag !=null">inquiry_list_flag=#{inquiryListFlag}</if>
            <if test="quoteListFlag !=null">quote_list_flag=#{quoteListFlag}</if>
            <if test="mark != null and mark != ''">and mark like concat('%', #{mark}, '%')</if>
            and del_flag=0

        </where>
    </select>
    
    <select id="selectSysProductByProductId" parameterType="String" resultMap="SysProductResult">
        <include refid="selectSysProductVo"/>
        where product_id = #{productId}
    </select>

    <insert id="insertSysProduct" parameterType="SysProduct">
        insert into sys_product
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="productId != null">product_id,</if>
            <if test="supplierId != null">supplier_id,</if>
            <if test="supplierName != null">supplier_name,</if>
            <if test="primaryCategory != null">primary_category,</if>
            <if test="primaryCategoryName != null">primary_category_name,</if>
            <if test="secondaryCategory != null">secondary_category,</if>
            <if test="secondaryCategoryName != null">secondary_category_name,</if>
            <if test="tertiaryCategory != null">tertiary_category,</if>
            <if test="tertiaryCategoryName != null">tertiary_category_name,</if>
            <if test="quaternaryCategory != null">quaternary_category,</if>
            <if test="quaternaryCategoryName != null">quaternary_category_name,</if>
            <if test="fifthCategory != null">fifth_category,</if>
            <if test="fifthCategoryName != null">fifth_category_name,</if>

            <if test="cnPrimaryCategory != null">cn_primary_category,</if>
            <if test="cnPrimaryCategoryName != null">cn_primary_category_name,</if>
            <if test="cnSecondaryCategory != null">cn_secondary_category,</if>
            <if test="cnSecondaryCategoryName != null">cn_secondary_category_name,</if>
            <if test="cnTertiaryCategory != null">cn_tertiary_category,</if>
            <if test="cnTertiaryCategoryName != null">cn_tertiary_category_name,</if>
            <if test="cnQuaternaryCategory != null">cn_quaternary_category,</if>
            <if test="cnQuaternaryCategoryName != null">cn_quaternary_category_name,</if>
            <if test="cnFifthCategory != null">cn_fifth_category,</if>
            <if test="cnFifthCategoryName != null">cn_fifth_category_name,</if>

            <if test="tagId != null">tag_id,</if>
            <if test="tagName != null">tag_name,</if>
            <if test="productImage != null">product_image,</if>
            <if test="productVideo != null">product_video,</if>

            <if test="productName != null">product_name,</if>
            <if test="domesticImportedType != null">domestic_imported_type,</if>
            <if test="productModel != null">product_model,</if>
            <if test="quotationFlag != null">quotation_flag,</if>
            <if test="futureField1 != null">future_field1,</if>
            <if test="futureField2 != null">future_field2,</if>
            <if test="futureField3 != null">future_field3,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="productId != null">#{productId},</if>
            <if test="supplierId != null">#{supplierId},</if>
            <if test="supplierName != null">#{supplierName},</if>
            <if test="primaryCategory != null">#{primaryCategory},</if>
            <if test="primaryCategoryName != null">#{primaryCategoryName},</if>
            <if test="secondaryCategory != null">#{secondaryCategory},</if>
            <if test="secondaryCategoryName != null">#{secondaryCategoryName},</if>
            <if test="tertiaryCategory != null">#{tertiaryCategory},</if>
            <if test="tertiaryCategoryName != null">#{tertiaryCategoryName},</if>
            <if test="quaternaryCategory != null">#{quaternaryCategory},</if>
            <if test="quaternaryCategoryName != null">#{quaternaryCategoryName},</if>
            <if test="fifthCategory != null">#{fifthCategory},</if>
            <if test="fifthCategoryName != null">#{fifthCategoryName},</if>

            <if test="cnPrimaryCategory != null">#{cnPrimaryCategory},</if>
            <if test="cnPrimaryCategoryName != null">#{cnPrimaryCategoryName},</if>
            <if test="cnSecondaryCategory != null">#{cnSecondaryCategory},</if>
            <if test="cnSecondaryCategoryName != null">#{cnSecondaryCategoryName},</if>
            <if test="cnTertiaryCategory != null">#{cnTertiaryCategory},</if>
            <if test="cnTertiaryCategoryName != null">#{cnTertiaryCategoryName},</if>
            <if test="cnQuaternaryCategory != null">#{cnQuaternaryCategory},</if>
            <if test="cnQuaternaryCategoryName != null">#{cnQuaternaryCategoryName},</if>
            <if test="cnFifthCategory != null">#{cnFifthCategory},</if>
            <if test="cnFifthCategoryName != null">#{cnFifthCategoryName},</if>
            <if test="tagId != null">#{tagId},</if>
            <if test="tagName != null">#{tagName},</if>
            <if test="productImage != null">#{productImage},</if>
            <if test="productVideo != null">#{productVideo},</if>

            <if test="productName != null">#{productName},</if>
            <if test="domesticImportedType != null">#{domesticImportedType},</if>
            <if test="productModel != null">#{productModel},</if>
            <if test="quotationFlag != null">#{quotationFlag},</if>
            <if test="futureField1 != null">#{futureField1},</if>
            <if test="futureField2 != null">#{futureField2},</if>
            <if test="futureField3 != null">#{futureField3},</if>
         </trim>
    </insert>

    <update id="updateSysProduct" parameterType="SysProduct">
        update sys_product
        <trim prefix="SET" suffixOverrides=",">
            <if test="supplierId != null">supplier_id = #{supplierId},</if>
            <if test="supplierName != null">supplier_name = #{supplierName},</if>
            <if test="primaryCategory != null">primary_category = #{primaryCategory},</if>
            <if test="primaryCategoryName != null">primary_category_name = #{primaryCategoryName},</if>
            <if test="secondaryCategory != null">secondary_category = #{secondaryCategory},</if>
            <if test="secondaryCategoryName != null">secondary_category_name = #{secondaryCategoryName},</if>
            <if test="tertiaryCategory != null">tertiary_category = #{tertiaryCategory},</if>
            <if test="tertiaryCategoryName != null">tertiary_category_name = #{tertiaryCategoryName},</if>
            <if test="quaternaryCategory != null">quaternary_category = #{quaternaryCategory},</if>
            <if test="quaternaryCategoryName != null">quaternary_category_name = #{quaternaryCategoryName},</if>
            <if test="fifthCategory != null">fifth_category = #{fifthCategory},</if>
            <if test="fifthCategoryName != null">fifth_category_name = #{fifthCategoryName},</if>
            <if test="productName != null">product_name = #{productName},</if>
            <if test="domesticImportedType != null">domestic_imported_type = #{domesticImportedType},</if>
            <if test="productModel != null">product_model = #{productModel},</if>
            <if test="quotationFlag != null">quotation_flag = #{quotationFlag},</if>
            <if test="futureField1 != null">future_field1 = #{futureField1},</if>
            <if test="futureField2 != null">future_field2 = #{futureField2},</if>
            <if test="futureField3 != null">future_field3 = #{futureField3},</if>
        </trim>
        where product_id = #{productId}
    </update>

    <!--  修改产品状态为1-已报价  -->
    <update id="updateSysProductStatus">
        update sys_product
        set future_field1 = 1
        where product_id = #{productId}
    </update>
    <!--  修改产品状态用于前端切换  -->
    <update id="updateStatus">
        update sys_product
        set quotation_flag = #{status}
        where product_id = #{productId}
    </update>

    <delete id="deleteSysProductByProductId" parameterType="String">
        delete from sys_product where product_id = #{productId}
    </delete>

    <delete id="deleteSysProductByProductIds" parameterType="String">
        delete from sys_product where product_id in 
        <foreach item="productId" collection="array" open="(" separator="," close=")">
            #{productId}
        </foreach>
    </delete>

    <select id="selectProductNamesByParam" resultType="java.lang.String">
    SELECT product_Name
    FROM sys_product
    WHERE future_field1 = '1'
      <if test="supplierId != null  and supplierId != ''">and supplier_id = #{supplierId}</if>
        <if test="productName != null  and productName != ''">AND product_Name LIKE CONCAT('%', #{productName}, '%')</if>
    </select>
</mapper>